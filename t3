applyDragEvents: function(element) {
  element.draggable = true;
  var dndHandler = this;

  element.addEventListener('dragstart', function(e) {
    startTimer();
    dndHandler.draggedElement = e.target;
    e.dataTransfer.setData('text/plain', '');
  });

  element.addEventListener('click', function(e) {
    const previousDraggedElement = document.querySelector('.dragging');
    if (previousDraggedElement) {
      previousDraggedElement.classList.remove('dragging');
    }
    dndHandler.draggedElement = e.target;
    e.target.classList.add('dragging');
  });

  element.addEventListener('touchstart', function(e) {
    if (typeof startTimer === 'function') startTimer();
    var el = e.target;
    dndHandler.draggedElement = el;
    var rect = el.getBoundingClientRect();
    dndHandler.offset = {
      x: rect.width / 2,
      y: rect.height / 2
    };
  }, { passive: true });

  element.addEventListener('touchmove', function(e) {
    e.preventDefault();
    var touch = e.touches[0];
    var el = dndHandler.draggedElement;

    el.classList.add('dragging-touch');
    el.style.left = (touch.clientX - dndHandler.offset.x) + 'px';
    el.style.top = (touch.clientY - dndHandler.offset.y) + 'px';

    var targetUnderFinger = document.elementFromPoint(touch.clientX, touch.clientY);
    var slot = targetUnderFinger ? targetUnderFinger.closest('.slot') : null;

    document.querySelectorAll('.over').forEach(s => s.classList.remove('over'));
    if (slot && slot.classList.contains(el.getAttribute('data-type'))) {
      slot.classList.add('over');
    }
  }, { passive: false });

  element.addEventListener('touchend', function(e) {
    var el = dndHandler.draggedElement;
    var touch = e.changedTouches[0];
    var targetUnderFinger = document.elementFromPoint(touch.clientX, touch.clientY);
    var slot = targetUnderFinger ? targetUnderFinger.closest('.slot') : null;

    el.classList.remove('dragging-touch');
    el.style.left = '';
    el.style.top = '';
    document.querySelectorAll('.over').forEach(s => s.classList.remove('over'));
    if (slot) {
      dndHandler.placeElement(slot);
    }
  });
}

applyDragEvents: function(element) {
      element.draggable = true;
      var dndHandler = this;
    
      element.addEventListener('mousedown', function(e) {
        if (e.button !== 0) return;
        startTimer();
        dndHandler.draggedElement = e.target;
        var rect = e.target.getBoundingClientRect();
        dndHandler.offset = {
          x: e.clientX - rect.left,
          y: e.clientY - rect.top
        };
    
        function onMouseMove(e) {
          var el = dndHandler.draggedElement;
          el.classList.add('dragging-desktop');
          el.style.left = (e.clientX - dndHandler.offset.x) + 'px';
          el.style.top = (e.clientY - dndHandler.offset.y) + 'px';
    
          var target = document.elementFromPoint(e.clientX, e.clientY);
          var slot = target ? target.closest('.slot') : null;
          document.querySelectorAll('.over').forEach(s => s.classList.remove('over'));
          if (slot && slot.classList.contains(el.getAttribute('data-type'))) {
            slot.classList.add('over');
          }
        }
    
        function onMouseUp(e) {
          var el = dndHandler.draggedElement;
          var target = document.elementFromPoint(e.clientX, e.clientY);
          var slot = target ? target.closest('.slot') : null;
    
          el.classList.remove('dragging-desktop');
          el.style.left = '';
          el.style.top = '';
          document.querySelectorAll('.over').forEach(s => s.classList.remove('over'));
          if (slot) {
            dndHandler.placeElement(slot);
          }
          document.removeEventListener('mousemove', onMouseMove);
          document.removeEventListener('mouseup', onMouseUp);
        }
    
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });
    
      element.addEventListener('touchstart', function(e) {
        if (typeof startTimer === 'function') startTimer();
        var el = e.target;
        dndHandler.draggedElement = el;
        var rect = el.getBoundingClientRect();
        dndHandler.offset = {
          x: rect.width / 2,
          y: rect.height / 2
        };
      }, { passive: true });
    
      element.addEventListener('touchmove', function(e) {
        e.preventDefault();
        var touch = e.touches[0];
        var el = dndHandler.draggedElement;
        el.classList.add('dragging-touch');
        el.style.left = (touch.clientX - dndHandler.offset.x) + 'px';
        el.style.top = (touch.clientY - dndHandler.offset.y) + 'px';
    
        var targetUnderFinger = document.elementFromPoint(touch.clientX, touch.clientY);
        var slot = targetUnderFinger ? targetUnderFinger.closest('.slot') : null;
        document.querySelectorAll('.over').forEach(s => s.classList.remove('over'));
        if (slot && slot.classList.contains(el.getAttribute('data-type'))) {
          slot.classList.add('over');
        }
      }, { passive: false });
    
      element.addEventListener('touchend', function(e) {
        var el = dndHandler.draggedElement;
        var touch = e.changedTouches[0];
        var targetUnderFinger = document.elementFromPoint(touch.clientX, touch.clientY);
        var slot = targetUnderFinger ? targetUnderFinger.closest('.slot') : null;
    
        el.classList.remove('dragging-touch');
        el.style.left = '';
        el.style.top = '';
        document.querySelectorAll('.over').forEach(s => s.classList.remove('over'));
        if (slot) {
          dndHandler.placeElement(slot);
        }
      });

      element.addEventListener('click', function(e) {
        const previousDraggedElement = document.querySelector('.dragging');
        if (previousDraggedElement) {
          previousDraggedElement.classList.remove('dragging');
        }
        dndHandler.draggedElement = e.target;
        e.target.classList.add('dragging');
      });
    },

    .dragging-touch {
  position: fixed !important;
  z-index: 1000;
  pointer-events: none;
  transform: scale(1.2);
  opacity: 0.9;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  background: #fff;
}
.dragging-desktop {
  position: fixed !important;
  z-index: 1000;
  pointer-events: none;
  transform: scale(1.1);
  opacity: 0.9;
}